<!DOCTYPE html>
<html>
<head>
<title>Music Player</title>

<style type="text/css">

* {
	padding: 0;
	margin: 0;
	box-sizing: border-box;
}

body {
	font-size: 16px;
	font-family: Arial, sans-serif;
	color: #ddd;
	background-color: #333;
}

tile {
	display: block;
  cursor: pointer;
	border: 1px solid #888;
	box-shadow: 0 3px 20px rgba(0, 0, 0, 0.8);
	width: 200px;
	height: 200px;
	background-size: cover;
  background-position-x: center;
  transition: 0.5s;
}

tile.selected {
  transform: perspective(400px) rotateY(20deg);
}

grid-cell {
	float: left;
	padding: 12px;
}

grid {
	display: block;
	padding: 10px;
	width: 100%;
}

player-container {
  display: block;
  position: absolute;
  top: -999px;
}

#top-bar {
  background-color: #111;
  padding: 10px;
  padding-left: 22px;
}

</style>

<script type="text/javascript" src="res/songs.js"></script>
<script type="text/javascript" src="res/player.js"></script>
<script type="text/javascript" src="res/random.js"></script>
<script type="text/javascript" src="res/grouping.js"></script>
<script type="text/javascript">

let groupings = GROUPINGS.map(groupingSpec => Grouping(groupingSpec))

function nextTrack() {
  let randomSelectedGrouping = chooseRandomly(groupings.filter(g => g.selected))

  return randomSelectedGrouping 
    ? randomSelectedGrouping.dequeue()
    : null
}

function play(track) {
  if (track) {
    Player.load(track.youtubeId)
    document.getElementsByTagName('title')[0].innerText = track.name
    Player.play()
  }
}

function handleSomethingHappening() {
  if (Player.nothingIsPlaying()) {
    play(nextTrack())
  }
}

Player.onUpdate(handleSomethingHappening)

</script>

</head>
<body>

<player-container>
  <div id="player"></div>
</player-container>

<div id="top-bar">
  <input id="shuffle-checkbox" type="checkbox" />
  <label>Shuffle</label>
</div>

<grid>
</grid>

<script>
// UI setup

document.getElementById('shuffle-checkbox').addEventListener('change', function(event) {
  for (let grouping of groupings) {
    grouping.setShuffle(event.target.checked)
  }
})

let grid = document.getElementsByTagName('grid')[0]

function createTile(imageUrl) {
  let tile = document.createElement('tile')
  tile.style = "background-image:url('" + imageUrl + "')"

  let gridCell = document.createElement('grid-cell')
  gridCell.appendChild(tile)
  grid.appendChild(gridCell)

  return tile
}

for (let grouping of groupings) {
  let tile = grouping.tile = createTile(grouping.imageUrl)
  tile.addEventListener('click', function() {
    if (grouping.selected) {
      tile.classList.remove('selected')
      grouping.selected = false
    } else {
      tile.classList.add('selected')
      grouping.selected = true
    }
    handleSomethingHappening()
  })
}
</script>

</body>
</html>